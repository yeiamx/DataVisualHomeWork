<!DOCTYPE html>
<html>
<title>W3.CSS Template</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="css/w3.css">
<link rel="stylesheet" href="css/font1.css">
<link rel="stylesheet" href="css/font2.css">
<script src="js/jquery-1.12.4.js"></script> 
<script src="js/d3.v3.min.js" charset="utf-8"></script>
<script src="js/d3.layout.cloud.js" charset="utf-8"></script>
<script src="js/finalResult.js" charset="utf-8"></script>
<style>
/* pink */  
.pink {  
    color: #feeef5;  
    border: solid 1px #d2729e;  
    background: #f895c2;  
    background: -webkit-gradient(linear, left top, left bottom, from(#feb1d3), to(#f171ab));  
    background: -moz-linear-gradient(top,  #feb1d3,  #f171ab);  
    filter:  progid:DXImageTransform.Microsoft.gradient(startColorstr='#feb1d3', endColorstr='#f171ab');  
}  
.pink:hover {  
    background: #d57ea5;  
    background: -webkit-gradient(linear, left top, left bottom, from(#f4aacb), to(#e86ca4));  
    background: -moz-linear-gradient(top,  #f4aacb,  #e86ca4);  
    filter:  progid:DXImageTransform.Microsoft.gradient(startColorstr='#f4aacb', endColorstr='#e86ca4');  
}  
.pink:active {  
    color: #f3c3d9;  
    background: -webkit-gradient(linear, left top, left bottom, from(#f171ab), to(#feb1d3));  
    background: -moz-linear-gradient(top,  #f171ab,  #feb1d3);  
    filter:  progid:DXImageTransform.Microsoft.gradient(startColorstr='#f171ab', endColorstr='#feb1d3');  
}  
/* button   
---------------------------------------------- */  
.button {  
    display: inline-block;  
    zoom: 1; /* zoom and *display = ie7 hack for display:inline-block */  
    *display: inline;  
    vertical-align: baseline;  
    margin: 0 4px;  
    outline: none;  
    cursor: pointer;  
    text-align: center;  
    text-decoration: none;  
    font: 14px/100% Arial, Helvetica, sans-serif;  
    padding: .5em 2em .55em;  
    text-shadow: 0 1px 1px rgba(0,0,0,.3);  
    -webkit-border-radius: .5em;   
    -moz-border-radius: .5em;  
    border-radius: .5em;  
    -webkit-box-shadow: 0 1px 2px rgba(0,0,0,.2);  
    -moz-box-shadow: 0 1px 2px rgba(0,0,0,.2);  
    box-shadow: 0 1px 2px rgba(0,0,0,.2);  
}  
.button:hover {  
    text-decoration: none;  
}  
.button:active {  
    position: relative;  
    top: 1px;  
}  
  
.bigrounded {  
    -webkit-border-radius: 2em;  
    -moz-border-radius: 2em;  
    border-radius: 2em;  
}  
.medium {  
    font-size: 12px;  
    padding: .4em 1.5em .42em;  
}  
.small {  
    font-size: 11px;  
    padding: .2em 1em .275em;  
}  

body {font-family: "Lato", sans-serif}
.mySlides {display: none}
</style>
<body>


<!-- Navbar -->
<div class="w3-top">
  <div class="w3-bar w3-black w3-card">
    <a class="w3-bar-item w3-button w3-padding-large w3-hide-medium w3-hide-large w3-right" href="javascript:void(0)" onclick="myFunction()" title="Toggle Navigation Menu"><i class="fa fa-bars"></i></a>
    <a href="#" class="w3-bar-item w3-button w3-padding-large">HOME</a>
    <a href="#member_container" class="w3-bar-item w3-button w3-padding-large w3-hide-small">MEMBER</a>
    <a href="#tour" class="w3-bar-item w3-button w3-padding-large w3-hide-small">TOUR</a>
    <a href="#contact" class="w3-bar-item w3-button w3-padding-large w3-hide-small">CONTACT</a>
    <div class="w3-dropdown-hover w3-hide-small">
      <button class="w3-padding-large w3-button" title="More">MORE <i class="fa fa-caret-down"></i></button>     
      <div class="w3-dropdown-content w3-bar-block w3-card-4">
        <a href="#" class="w3-bar-item w3-button">Merchandise</a>
        <a href="#" class="w3-bar-item w3-button">Extras</a>
        <a href="#" class="w3-bar-item w3-button">Media</a>
      </div>
    </div>
    <a href="javascript:void(0)" class="w3-padding-large w3-hover-red w3-hide-small w3-right"><i class="fa fa-search"></i></a>
  </div>
</div>

<!-- Navbar on small screens (remove the onclick attribute if you want the navbar to always show on top of the content when clicking on the links) -->
<div id="navDemo" class="w3-bar-block w3-black w3-hide w3-hide-large w3-hide-medium w3-top" style="margin-top:46px">
  <a href="#member_container" class="w3-bar-item w3-button w3-padding-large" onclick="myFunction()">MEMBER</a>
  <a href="#tour" class="w3-bar-item w3-button w3-padding-large" onclick="myFunction()">TOUR</a>
  <a href="#contact" class="w3-bar-item w3-button w3-padding-large" onclick="myFunction()">CONTACT</a>
  <a href="#" class="w3-bar-item w3-button w3-padding-large" onclick="myFunction()">MERCH</a>
</div>

<!-- Page content -->
<div class="w3-content" style="max-width:2000px;margin-top:46px">

  <!-- The Band Section -->
  <div class="w3-container w3-content w3-center w3-padding-64" style="max-width:800px" id="member_container">
	<button id="draw" class="button pink">Draw</button>
	<button id="empty" class="button pink">Empty</button>
	<div>模式：   
		<label>个人：<input type="radio" name="mode_radio" id="self_mode"></label>
		<label>团体：<input type="radio" name="mode_radio" id="group_mode" checked></label>
	</div>
	<div class="w3-container w3-content w3-center" id="member"></div>
  </div>

  <!-- The Tour Section -->
  <div class="w3-container w3-content w3-center w3-padding-64" style="max-width:800px" id="tour">
	<div class="panel panel-default"  style="margin-top: 30px;">
		<div class="panel-heading">
			<strong  id="canvasTitle">情感(热度)趋势</strong>
		</div>
		<div class="panel-body" style="padding:0px;">
			<svg id="svgCanvas" width="100%" height="400">
			</svg>
		</div>
	</div>
  </div>

  <!-- Ticket Modal -->
  <div id="ticketModal" class="w3-container w3-content w3-center w3-padding-64" style="max-width:800px">
	<div class="panel panel-default"  style="margin-top: 30px;">
		<div class="panel-body" style="padding:0px;">
			<svg id="svgWordleCanvas" width="100%" height="400">
			</svg>
		</div>
	</div>
  </div>

  <!-- The Contact Section -->
  <div class="w3-container w3-content w3-center w3-padding-64" style="max-width:800px" id="contact">
    <div>444444</div>
  </div>
  
<!-- End Page Content -->

<script>	
	var member_element = document.getElementById("member");
	var self_radio_element = document.getElementById('self_mode');
	var group_radio_element = document.getElementById('group_mode');
	var draw_button = document.getElementById('draw')
	var empty_button = document.getElementById('empty')
	var lines = [];
	var wordleFinalAdjustResult = wordleFinalResult;
	//console.log(member_element.nodeType)
	
	for (var i=0; i<memberName.length; i++) {
		var name_label_element = document.createElement("label");
		var name_input_element = document.createElement("input");
		var name_image_element = document.createElement("img");
		name_image_element.setAttribute('src',"img/101pic/"+i+".jpg");
		name_image_element.setAttribute('height','60');
		name_image_element.setAttribute('width','60');

		name_label_element.setAttribute('style',"display:inline-block;width:70px");
		name_label_element.setAttribute('id', memberName[i]+'_label'); 

		name_input_element.setAttribute('id', memberName[i]+'_check');
		name_input_element.setAttribute('type', "checkbox");
		name_input_element.setAttribute('style', "margin: 3px");
		


		// name_label_element.setAttribute('style',"font-size:10px;display:inline-block;width:50px;background-image: url(./101pic/101pic/"+i+".jpg);background-size:cover;padding: 10px");

		name_label_element.appendChild(name_image_element)
		name_label_element.appendChild(document.createTextNode(memberName[i]));
		name_label_element.appendChild(name_input_element)

		member_element.appendChild(name_label_element)

	}


	function addOptions(mode){
		for (var i=0; i<memberName.length; i++) {
			//console.log('add '+i)
			var name_label_element = document.createElement("label");
			var name_input_element = document.createElement("input");
			var name_image_element = document.createElement("img");
			
			name_image_element.setAttribute('src',"img/101pic/"+i+".jpg");
			name_image_element.setAttribute('height','60');
			name_image_element.setAttribute('width','60');

			name_label_element.setAttribute('style',"display:inline-block;width:70px");
			name_label_element.setAttribute('id', memberName[i]+'_label'); 
			if (mode=='group'){
				name_input_element.setAttribute('id', memberName[i]+'_check');
				name_input_element.setAttribute('type', "checkbox");
			}
			else {
				name_input_element.setAttribute('id', memberName[i]+'_radio');
				name_input_element.setAttribute('type', 'radio');
				name_input_element.setAttribute('name', 'radio_options');
			}
			name_input_element.setAttribute('style', "margin: 3px");

			name_label_element.appendChild(name_image_element)
			name_label_element.appendChild(document.createTextNode(memberName[i]));
			name_label_element.appendChild(name_input_element)

			member_element.appendChild(name_label_element)
			//console.log(name_label_element);
		}
	}
	
	function empty() {
		lines.length = 0;
		$("#svgCanvas").empty()
		$("#svgWordleCanvas").empty()
	}
	
	function draw() {
		empty()
		
		if (self_radio_element.checked) {
			for (var i=0; i<self.memberName.length; i++) {
				var radio_option_element = document.getElementById(memberName[i]+'_radio');
				if (radio_option_element.checked){
					console.log(memberName[i]+" being checked")
					drawLineWithWidth(i);
					drawMemberWords(i);
					break;
				}
			}
		} else {
			for (var i=0; i<self.memberName.length; i++) {
				var check_option_element = document.getElementById(memberName[i]+'_check');
				if (check_option_element.checked){
					console.log(memberName[i]+" being checked")
					drawLine(i);
					if (lines.indexOf(i)<0) {
						lines.push(i);
					}
				}
			}
			drawLengend();
		}
	}
	
	function drawLengend() {
	  var legend = canvas.append("g")
	  .attr("class", "legend")
        //.attr("x", w - 65)
        //.attr("y", 50)
	  .attr("height", 100)
	  .attr("width", 100)
	  .attr('transform', 'translate(-20,50)')
    
    legend.selectAll('rect')
      .data(lines)
      .enter()
      .append("rect")
	  .attr("x", width - 65)
      .attr("y", function(d, i){ return i *  20;})
	  .attr("width", 10)
	  .attr("height", 10)
	  .style("fill", function(d) { 
        var color = colors[d];
        return color;
      })
      
    legend.selectAll('text')
      .data(lines)
      .enter()
      .append("text")
	  .attr("x", width - 52)
      .attr("y", function(d, i){ return i *  20 + 9;})
	  .text(function(d) {
        return memberName[d];
      });
	}
	
	function adjustWordleSize() {
		var adjustName = ['孟美岐', '杨超越', '王菊', '杨芸晴'];
		var adjustK = [2, 3, 2, 2];
		//var adjustCommentName = ['李子璇', '孟美岐'];
		//var adjustCommentK = [2, 0.5];
		for (var i=0; i<adjustName.length; i++) {
			//console.log(adjustName[i]+" :"+wordleFinalResult[adjustName[i]]);
			for (var j=0; j<wordleFinalResult[adjustName[i]].length; j++){
				wordleFinalAdjustResult[adjustName[i]][j][1] = wordleFinalAdjustResult[adjustName[i]][j][1]/adjustK[i];
			}
		}
		
		//for (var i=0; i<adjustCommentName.length; i++) {
			//console.log(adjustName[i]+" :"+wordleFinalResult[adjustName[i]]);
		//	for (var j=0; j<wordleFinalResult[adjustCommentName[i]].length; j++){
		//		wordleFinalResult[adjustCommentName[i]][j][1] = wordleFinalResult[adjustCommentName[i]][j][1]/adjustCommentK[i];
		//	}
		//}
	}
	
	function drawWordle(words) {
		wordleCanvas.append("g")
                // without the transform, words words would get cutoff to the left and top, they would
                // appear outside of the SVG area
                .attr("transform", "translate(320,200)")
                .selectAll("text")
                .data(words)
                .enter().append("text")
                .style("font-size", function(d) { return d.size + "px"; })
                .style("fill", function(d, i) { return wordleColors(i); })
                .attr("transform", function(d) {
                    return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
                })
                .text(function(d) { return d.text; });	
	}
	
	function getFrequencyList(i){
		var frequency_list = [];
		var words = wordleFinalAdjustResult[memberName[i]];
		for (var i=0; i<80; i++) {
			var object = {};
			object["text"] = words[i][0]; object['size'] = words[i][1] / 10;
			frequency_list.push(object);
		}
		return frequency_list;
	}
	
	//画某个成员的wordle
	function drawMemberWords(i) {
		var frequency_list = getFrequencyList(i);
				
		wordleColors
				.domain([0,1,2,3,4,5,6,10,15,20,100])
				.range(["#ddd", "#ccc", "#bbb", "#aaa", "#999", "#888", "#777", "#666", "#555", "#444", "#333", "#222"]);
		d3.layout.cloud().size([800, 300])
				.words(frequency_list)
				.rotate(0)
				.fontSize(function(d) { return d.size; })
				.on("end", drawWordle)
				.start();
	}
	
	function changeToSelfMode() {
		$("#member").empty();
		empty()
		addOptions('self')
	}
	
	function changeToGroupMode() {
		$("#member").empty();
		empty()
		addOptions('group')
	}
	adjustWordleSize();
	//  获取颜色组合
	var colors = ["#1f77b4", "#aec7e8", "#ff7f0e", "#ffbb78", "#2ca02c", "#98df8a", "#d62728", "#ff9896", "#9467bd", "#c5b0d5", "#8c564b", "#c49c94", "#e377c2", "#f7b6d2", "#7f7f7f", "#c7c7c7", "#bcbd22", "#dbdb8d", "#17becf", "#9edae5"],
		len = colors.length,
		//  获取相关的曲线工厂
		curves = ['curveBasis', 'curveBasisClosed', 'curveBasisOpen', 'curveBundle', 'curveCardinal','curveCardinalClosed', 'curveCardinalOpen', 'curveCatmullRom', 'curveCatmullRomClosed','curveCatmullRomOpen', 'curveLinear','curveLinearClosed', 'curveMonotoneX', 'curveMonotoneY',
				 'curveNatural', 'curveStep', 'curveStepAfter', 'curveStepBefore'];
		//console.log(colors)
		colors.push('#FF82AB')
		colors.push('#CD5C5C')
	var wordleColors = d3.scale.linear();
			
	empty_button.onclick = empty;
	draw_button.onclick = draw;
	self_radio_element.onchange = changeToSelfMode;
	group_radio_element.onchange = changeToGroupMode;
	var width = 800;	//画布的宽度
	var height = 600;	//画布的高度
			
	canvas = d3.select('#svgCanvas')	//获取画布
				.attr("width", width)		//设定宽度
				.attr("height", height);	//设定高度,   
	wordleCanvas = d3.select('#svgWordleCanvas')	//获取wordle画布
				.attr("width", width)		//设定宽度
				.attr("height", height)	//设定高度,
				.attr("class", "wordcloud");
    canvasTitle = d3.select('#canvasTitle'),    //  获取标题区域
    lineGenerator = d3.svg.line()
                      .x(function(d) {
                            return d[0]
                        })
                      .y(function(d) {
                            return d[1];
                       });
	
	


	//self_mode
	
	//drawLine(memberName.indexOf('王菊'))
	//drawLine(memberName.indexOf('杨超越'))
	
	
	

</script>

</body>
</html>